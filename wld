#!/usr/bin/env bash
# set -euo pipefail

source cli/utils.sh

USER_ARGUMENT="${1:-status}"
ALLOWED_FUNCTIONS=("site" "install" "env" "status" "delete-wp-fs" "scaffold")

# Define function to call other scripts
call_script() {
    local script_name="$1"
    local script_path="${CLI_DIR}/${script_name}.sh"

    if [[ -f "$script_path" ]]; then
        bash "$script_path"
    else
        echo "Script does not exist: $script_name"
        exit 1
    fi
}

function main() {
    local func_name="$1"
    local found=0

    echo "func_name: ${func_name}"

    for name in "${ALLOWED_FUNCTIONS[@]}"; do
        if [[ "$name" == "$func_name" ]]; then
            found=1
            break
        fi
    done

    # Step 4: If it does, execute the function. If it doesn't exist, throw an error.
    if [[ $found -eq 1 ]]; then
        call_script $func_name
    else
        echo "Error: Function '$func_name' not allowed."
    fi
}

main "${USER_ARGUMENT}"

exit 0
